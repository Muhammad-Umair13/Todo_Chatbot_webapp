["spec.md](spec.md)\n**Input**: Feature specification from `/specs/003-database-schema/spec.md`\n\n## Summary\n\nImplement a PostgreSQL-based task persistence system with strict user isolation for Phase II of the Todo Web Application. The system will use SQLModel for ORM, Alembic for migrations, and Neon Serverless PostgreSQL for storage. All task operations enforce ownership at the database level through user_id filtering, ensuring zero data leakage between users.\n\n## Technical Context\n\n**Language/Version**: Python 3.13+  \n**Primary Dependencies**: FastAPI, SQLModel, Alembic, Pydantic v2  \n**Storage**: Neon Serverless PostgreSQL  \n**Testing**: pytest  \n**Target Platform**: Linux server (web application backend)  \n**Project Type**: web (backend + frontend)  \n**Performance Goals**: <500ms task retrieval for users with up to 1,000 tasks  \n**Constraints**: Stateless architecture, JWT required on protected routes, ORM only (no raw SQL)  \n**Scale/Scope**: Multi-user todo application, tasks persist across server restarts\n\n## Constitution Check\n\n*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*\n\n### Mandatory Requirements (from constitution.md)\n\n1. **Spec-Driven Development**: \u2705 PASS\n   - Implementation will trace back to approved spec (spec.md)\n   - Code will originate from tasks in tasks.md (Phase 2)\n   - Single source of truth maintained\n\n2. **PostgreSQL Persistence Standard**: \u2705 PASS\n   - Neon Serverless PostgreSQL selected\n   - SQLModel ORM (no raw SQL)\n   - Alembic migrations required\n   - Browser storage NOT used\n   - Task table includes: id, user_id, title, description, completed, created_at, updated_at\n\n3. **JWT Authentication & User Isolation**: \u2705 PASS\n   - Better Auth is the authentication authority (external)\n   - JWT verified by FastAPI\n   - user_id extracted from token\n   - user_id enforced at query level\n   - 401 for invalid token, 403 for unauthorized access\n   - Backend never stores passwords or creates users\n\n4. **Testing Discipline**: \u2705 PASS\n   - pytest will be used\n   - Tests will validate: authentication, JWT verification, user data isolation, database persistence, error paths\n   - Positive, negative, and ownership tests required\n\n5. **Security & Error Handling**: \u2705 PASS\n   - No secrets in code (environment variables)\n   - All inputs validated\n   - CORS explicitly configured\n   - ORM only\n   - Structured JSON errors\n   - No stack traces in production\n   - User-friendly messages\n\n6. **Phase III Forward Compatibility**: \u2705 PASS\n   - Fully API-driven (REST endpoints)\n   - Stateless architecture\n   - User isolation enforced\n   - Task operations exposed as services\n   - No schema changes required for MCP tools\n\n7. **API & Frontend Contract Standard**: \u2705 PASS\n   - Pure REST API\n   - Stateless\n   - JWT required on all protected routes\n   - Ownership enforced in every query\n   - Structured JSON errors\n\n### Quality Standards\n\n**Backend (Python / FastAPI)**: \u2705 PASS\n   - Python 3.13+\n   - FastAPI best practices\n   - SQLModel ORM only\n   - Pydantic v2 models\n   - Type hints REQUIRED\n   - OpenAPI will be accurate\n   - Environment variables for secrets\n   - Stateless architecture\n\n**Frontend (Next.js / TypeScript)**: \u2705 PASS\n   - Next.js 16+ App Router\n   - TypeScript strict mode\n   - Server Components by default\n   - No localStorage persistence for tasks\n   - Centralized API client\n\n### Conclusion\n\nAll constitution gates PASS. No violations to justify. Ready for Phase 0 research.\n\n## Project Structure\n\n### Documentation (this feature)\n\n```text\nspecs/003-database-schema/\n\u251c\u2500\u2500 plan.md              # This file (/sp.plan command output)\n\u251c\u2500\u2500 research.md          # Phase 0 output (/sp.plan command)\n\u251c\u2500\u2500 data-model.md        # Phase 1 output (/sp.plan command)\n\u251c\u2500\u2500 quickstart.md        # Phase 1 output (/sp.plan command)\n\u251c\u2500\u2500 contracts/           # Phase 1 output (/sp.plan command)\n\u2502   \u2514\u2500\u2500 openapi.yaml\n\u2514\u2500\u2500 tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)\n```\n\n### Source Code (repository root)\n\n```text\nbackend/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 task.py              # SQLModel task entity\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 task_service.py      # Task CRUD operations\n\u2502   \u251c\u2500\u2500 routers/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 tasks.py             # Task API endpoints\n\u2502   \u251c\u2500\u2500 schemas/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 task.py              # Pydantic models for API\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 config.py            # Database configuration\n\u2502   \u251c\u2500\u2500 auth/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 dependencies.py      # JWT dependency\n\u2502   \u2514\u2500\u2500 database.py              # Database connection\n\u2514\u2500\u2500 tests/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 conftest.py              # Test fixtures\n    \u251c\u2500\u2500 unit/\n    \u2502   \u251c\u2500\u2500 __init__.py\n    \u2502   \u2514\u2500\u2500 test_task_service.py # Unit tests\n    \u2514\u2500\u2500 integration/\n        \u251c\u2500\u2500 __init__.py\n        \u2514\u2500\u2500 test_tasks_api.py    # API tests\n\nalembic/\n\u251c\u2500\u2500 versions/\n\u2502   \u2514\u2500\u2500 001_initial.py           # Initial migration\n\u2514\u2500\u2500 env.py\n\nfrontend/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 task-service.ts      # API client for tasks\n\u2502   \u2514\u2500\u2500 lib/\n\u2502       \u2514\u2500\u2500 api-client.ts        # Centralized API client\n\u2514\u2500\u2500 tests/\n```\n\n**Structure Decision**: Web application with backend (FastAPI) and frontend (Next.js) in monorepo structure. Backend uses service layer pattern for business logic, routers for API endpoints, and SQLModel for database operations. Frontend uses centralized API client for communication.\n\n## Complexity Tracking\n\n> No constitution violations. This section not required."]